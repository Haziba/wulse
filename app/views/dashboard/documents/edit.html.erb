<div class="max-w-5xl mx-auto px-6 py-8">
  <div class="mb-8">
    <div class="flex justify-between items-start gap-4">
      <div>
        <h2 class="font-serif text-3xl font-bold text-gray-900 mb-2">Edit Document</h2>
        <p class="text-gray-600">Update document details and metadata</p>
      </div>
      <div class="flex items-center space-x-3">
        <button type="submit" form="edit-document-form" class="bg-brand-500 text-white p-3 md:px-6 md:py-3 rounded-lg hover:bg-brand-600 font-medium">
          <i class="fas fa-save md:hidden"></i>
          <span class="hidden md:inline">Save Changes</span>
        </button>
        <%= link_to dashboard_document_path(@document), method: :delete,
            data: { turbo_method: "delete", turbo_frame: "_top", turbo_confirm: "Are you sure you want to delete this document? This action cannot be undone." },
            class: "bg-red-100 text-red-700 p-3 md:px-6 md:py-3 rounded-lg hover:bg-red-200 transition-colors font-medium flex items-center space-x-2" do %>
          <i class="fas fa-trash"></i>
          <span class="hidden md:inline">Delete</span>
        <% end %>
      </div>
    </div>
  </div>

  <%= form_with model: @document, url: dashboard_document_path(@document), method: :patch, id: "edit-document-form", class: "space-y-8" do |f| %>
    <div class="bg-white rounded-xl border border-gray-200 p-6" data-controller="file-upload">
      <h3 class="font-semibold text-lg text-gray-900 mb-6">Document</h3>
      <div class="grid md:grid-cols-3 gap-6">
        <div class="md:col-span-1">
          <div class="relative group cursor-pointer" onclick="document.getElementById('document-file-input').click()">
            <div class="bg-brand-500 bg-opacity-90 text-white py-3 px-4 rounded-lg flex items-center justify-center space-x-2 group-hover:bg-opacity-100 transition-all">
              <i class="fas fa-upload"></i>
              <span class="font-medium">Upload file</span>
            </div>
          </div>

          <%= f.file_field :file, id: "document-file-input", class: "hidden", accept: "application/pdf,application/epub+zip", data: { file_upload_target: "input", action: "change->file-upload#updatePreview" } %>
        </div>
        <div class="md:col-span-2 space-y-4">
          <div class="flex flex-col gap-4 text-sm <%= 'hidden' unless @document.file.attached? %>" data-file-upload-target="info">
            <div>
              <span class="font-medium text-gray-700">File Name:</span>
              <span class="text-gray-600 ml-2" data-file-upload-target="filename"><%= @document.file.attached? ? @document.file.filename : '' %></span>
            </div>
            <div>
              <span class="font-medium text-gray-700">File Size:</span>
              <span class="text-gray-600 ml-2" data-file-upload-target="filesize"><%= @document.file.attached? ? number_to_human_size(@document.file.byte_size) : '' %></span>
            </div>
          </div>
          <% if @document.metadata.find_by(key: 'keywords') %>
            <div>
              <span class="font-medium text-gray-700 text-sm">Keywords:</span>
              <div class="flex flex-wrap gap-2 mt-2">
                <% @document.metadata.find_by(key: 'keywords').value.split(',').each do |keyword| %>
                  <span class="bg-brand-100 text-brand-700 px-2 py-1 rounded-full text-xs"><%= keyword.strip %></span>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl border border-gray-200 p-6" data-controller="metadata-fields">
      <h3 class="font-semibold text-lg text-gray-900 mb-6">Document Metadata</h3>

      <div data-metadata-fields-target="container" class="space-y-4">
        <%= f.fields_for :metadata, @metadata do |metadata_form| %>
          <%= render "metadata_row",
              index: metadata_form.index,
              key: metadata_form.object.key,
              value: metadata_form.object.value,
              required: Document::REQUIRED_METADATA.include?(metadata_form.object.key),
              editable: true,
              destroy_value: metadata_form.object._destroy || 0 %>
        <% end %>
      </div>

      <template data-metadata-fields-target="template">
        <%= render "metadata_row",
            index: "INDEX",
            key: "",
            value: "",
            required: false,
            editable: true,
            destroy_value: 0 %>
      </template>

      <div class="flex justify-center pt-4">
        <button type="button"
                class="bg-brand-50 text-brand-600 px-4 py-2 rounded-lg hover:bg-brand-100 font-medium flex items-center space-x-2"
                data-action="click->metadata-fields#addRow">
          <i class="fas fa-plus"></i>
          <span>Add Another Row</span>
        </button>
      </div>
    </div>
  <% end %>
</div>
