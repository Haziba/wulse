<!-- Results Header -->
<div class="flex items-center justify-between mb-6">
  <div>
    <h2 class="text-2xl font-bold text-gray-900">Search Results</h2>
    <p class="text-gray-600"><%= filtered_count %>/<%= total_count %> documents found<%= " for \"#{query}\"" if query.present? %></p>
  </div>
  <div class="flex items-center space-x-4">
    <span class="text-sm text-gray-600">Sort by:</span>
    <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
      <option>Relevance</option>
      <option>Publication Date</option>
      <option>Title</option>
      <option>Author</option>
    </select>
    <div class="flex border border-gray-300 rounded-lg">
      <button class="p-2 bg-brand-500 text-white rounded-l-lg">
        <i class="fas fa-list"></i>
      </button>
      <button class="p-2 text-gray-500 hover:bg-gray-100 rounded-r-lg">
        <i class="fas fa-th"></i>
      </button>
    </div>
  </div>
</div>

<!-- Search Results List -->
<div class="space-y-6">
  <% documents.each do |document| %>
    <div class="flex items-start justify-between mb-4 bg-white rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow gap-4">
      <div class="w-24 flex-shrink text-center">
        <%= image_tag document.preview_image, class: "rounded-lg object-cover" if document.preview_image.attached? %>
      </div>
      <div class="flex-grow">
        <div class="flex items-start justify-between mb-4">
          <div class="flex items-center space-x-3">
            <span class="bg-brand-100 text-brand-700 px-3 py-1 rounded-full text-sm font-medium">Document</span>
            <span class="text-sm text-gray-500"><%= document.staff&.name || "Unknown Author" %></span>
            <span class="text-sm text-gray-500">•</span>
            <span class="text-sm text-gray-500"><%= document.created_at.year %></span>
          </div>
          <div class="flex items-center space-x-2">
            <button class="text-gray-400 hover:text-brand-500">
              <i class="fas fa-bookmark"></i>
            </button>
            <button class="text-gray-400 hover:text-brand-500">
              <i class="fas fa-share-alt"></i>
            </button>
          </div>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-2 cursor-pointer hover:text-brand-500">
          <%= document.title %>
        </h3>
        <p class="text-gray-600 mb-3">
          <%= truncate(document.title, length: 200) %>
        </p>
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4 text-sm text-gray-500">
            <span><%= document.staff&.name || "Unknown" %></span>
            <span>•</span>
            <span><%= time_ago_in_words(document.updated_at) %> ago</span>
          </div>
          <div class="flex gap-2">
            <%= link_to library_read_path(document), class: "bg-brand-500 text-white px-4 py-2 rounded-lg hover:bg-brand-600 transition-colors text-sm", data: { turbo_frame: "_top" } do %>
              <i class="fas fa-book-open mr-2"></i>Read
            <% end %>
            <% if document.file.attached? %>
              <%= link_to rails_blob_path(document.file, disposition: "attachment"), class: "bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm" do %>
                <i class="fas fa-download"></i>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<!-- Pagination -->
<div class="flex items-center justify-between mt-8 pt-6 border-t border-gray-200">
  <div class="text-sm text-gray-600">
    Showing <%= pagy.from %> to <%= pagy.to %> of <%= pagy.count %> results
  </div>
  <div class="flex items-center space-x-2">
    <% if pagy.prev %>
      <%= link_to library_path(page: pagy.prev, q: query), class: "px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100", data: { turbo_frame: "library_list", turbo_action: "advance" } do %>
        <i class="fas fa-chevron-left"></i>
      <% end %>
    <% else %>
      <span class="px-3 py-2 border border-gray-300 rounded-lg text-gray-500">
        <i class="fas fa-chevron-left"></i>
      </span>
    <% end %>

    <% pagy.series.each do |item| %>
      <% if item.is_a?(Integer) %>
        <%= link_to item, library_path(page: item, q: query), class: "px-3 py-2 #{item == pagy.page ? 'bg-brand-500 text-white' : 'border border-gray-300 text-gray-700 hover:bg-gray-100'} rounded-lg", data: { turbo_frame: "library_list", turbo_action: "advance" } %>
      <% elsif item.is_a?(String) %>
        <span class="px-3 py-2 text-gray-500"><%= item %></span>
      <% elsif item == :gap %>
        <span class="px-2 text-gray-500">...</span>
      <% end %>
    <% end %>

    <% if pagy.next %>
      <%= link_to library_path(page: pagy.next, q: query), class: "px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100", data: { turbo_frame: "library_list", turbo_action: "advance" } do %>
        <i class="fas fa-chevron-right"></i>
      <% end %>
    <% else %>
      <span class="px-3 py-2 border border-gray-300 rounded-lg text-gray-500">
        <i class="fas fa-chevron-right"></i>
      </span>
    <% end %>
  </div>
</div>
