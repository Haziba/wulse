<!-- Main Content with Search Form -->
<%= form_with url: library_path,
              method: :get,
              data: { turbo_frame: "_top", controller: "debounce-submit" },
              class: "space-y-0" do %>

  <!-- Search Header -->
  <section class="bg-white border-b border-gray-200 py-4 sm:py-6">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      <div class="max-w-4xl mx-auto">
        <div class="flex">
          <%= text_field_tag :q, params[:q],
            placeholder: "Search...",
            class: "flex-1 px-4 py-3 text-base border-2 border-gray-300 border-r-0 rounded-l-lg focus:border-brand-500 focus:outline-none focus:z-10",
            data: { controller: "sync-search-with-query", action: "input->debounce-submit#debouncedSubmit" } %>
          <button type="submit" class="px-4 py-3 bg-brand-500 text-white rounded-r-lg hover:bg-brand-600 transition-colors cursor-pointer border-2 border-brand-500">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
    </div>
  </section>

  <div class="max-w-7xl mx-auto px-6 py-8" data-controller="sidebar">
    <div class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden"
         data-sidebar-target="overlay"
         data-action="click->sidebar#close"></div>

    <div class="flex gap-8">
      <!-- Sidebar Filters -->
      <aside class="w-80 flex-shrink-0 fixed lg:static top-0 left-0 h-full lg:h-auto bg-white z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 overflow-y-auto"
             data-sidebar-target="sidebar">
        <div id="filters_list">
          <%= render "filters_list", filters: @filters %>
        </div>
      </aside>

      <!-- Results Content -->
      <main class="flex-1">
        <%= turbo_frame_tag "library_list" do %>
          <%= render "library_list", documents: @documents, pagy: @pagy, query: @query, filtered_count: @filtered_count, total_count: @total_count %>
        <% end %>
      </main>
    </div>
  </div>
<% end %>
