<!-- Search Header -->
<section class="bg-white border-b border-gray-200 py-6">
  <div class="max-w-7xl mx-auto px-6">
    <div class="max-w-4xl mx-auto" data-controller="library-search" data-library-search-frame-value="library_list">
      <div class="relative">
        <input type="text"
               placeholder="Search documents..."
               value="<%= @query %>"
               class="w-full px-6 py-3 text-lg border-2 border-gray-300 rounded-xl focus:border-brand-500 focus:outline-none pl-14"
               data-library-search-target="input"
               data-action="input->library-search#searchDebounced">
        <i class="fas fa-search absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-400 text-lg"></i>
        <button class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-brand-500 text-white px-6 py-2 rounded-lg hover:bg-brand-600 transition-colors cursor-pointer"
                data-action="click->library-search#search">
          Search
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Search Results -->
<div class="max-w-7xl mx-auto px-6 py-8">
  <div class="flex gap-8">
    <!-- Sidebar Filters -->
    <aside class="w-80 flex-shrink-0">
      <div class="bg-white rounded-lg border border-gray-200 p-6">
        <h3 class="font-semibold text-gray-900 mb-4">Refine Results</h3>

        <% @filters.each do |filter_key, filter_values| %>
          <div class="mb-6" data-controller="filter-list library-search" data-library-search-frame-value="library_list">
            <div class="flex items-center justify-between mb-3">
              <h4 class="font-medium text-gray-700"><%= filter_key.to_s.humanize %></h4>
              <div class="flex gap-2 text-xs">
                <a href="#" class="text-brand-500 hover:text-brand-600" data-action="click->filter-list#selectAll">All</a>
                <span class="text-gray-400">|</span>
                <a href="#" class="text-brand-500 hover:text-brand-600" data-action="click->filter-list#selectNone">None</a>
              </div>
            </div>
            <div class="space-y-2">
              <% filter_values.each do |value, (filtered_count, total_count)| %>
                <%
                  filter_param_key = filter_key.to_s
                  is_checked = params[filter_param_key].nil? || params[filter_param_key].include?(value)
                %>
                <label class="flex items-center" data-filter-list-target="item">
                  <input type="checkbox"
                         class="text-brand-500 rounded"
                         data-filter-list-target="checkbox"
                         data-param="<%= filter_param_key %>"
                         name="<%= filter_param_key %>[]"
                         value="<%= value %>"
                         <%= 'checked' if is_checked %>
                         data-action="change->library-search#search">
                  <span class="ml-2 text-sm text-gray-600"><%= value.titleize %> (<%= number_with_delimiter(filtered_count) %>/<%= number_with_delimiter(total_count) %>)</span>
                </label>
              <% end %>
            </div>
            <button type="button"
                    class="mt-2 text-sm text-brand-500 hover:text-brand-600 font-medium hidden"
                    data-filter-list-target="toggle"
                    data-action="click->filter-list#toggle">
              Show all
            </button>
          </div>
        <% end %>
      </div>
    </aside>

    <!-- Results Content -->
    <main class="flex-1">
      <%= turbo_frame_tag "library_list" do %>
        <%= render "library_list", documents: @documents, pagy: @pagy, query: @query, filtered_count: @filtered_count, total_count: @total_count, filtered_filters: @filtered_filters %>
      <% end %>
    </main>
  </div>
</div>
</footer>
